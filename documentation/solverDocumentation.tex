\documentclass[a4paper,10pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amssymb}
\usepackage{url}

%opening
\title{LifT\_Solver Manual}
\author{}

\begin{document}

\maketitle



\section{Cloning the repository}
\begin{enumerate}
 \item Type \texttt{git clone https://github.com/AndreaHor/LifT\_Solver.git} for cloning the repository.
 \item Type \texttt{git submodule update --remote --recursive --init} for  getting the submodules.
 \end{enumerate}
\section{Setting up Gurobi}

\begin{enumerate}
 \item Download Gurobi from \url{www.gurobi.com} and get the license. 
 \item Go to \texttt{LifT\_Solver/solverILP/cmake/modules/FindGUROBI.cmake} and make sure that your Gurobi version matches the version in this file. If not, modify the respective parts of the file to match your Gurobi version. 
 \item Set up your system variables to contain paths to Gurobi as described below.
 \end{enumerate}
 \paragraph{Linux}
Open \texttt{.bash\_profile} in your home directory and add the following lines containing location of your files:\\
\texttt{export GUROBI\_HOME="/your/path/to/gurobi/gurobi902/linux64"\\
export PATH="\${PATH}:\${GUROBI\_HOME}/bin"\\
export LD\_LIBRARY\_PATH="\${GUROBI\_HOME}/lib"\\ 
export GRB\_LICENSE\_FILE="/your/path/to/gurobi/license/gurobi.lic" }\\
You need to rebbot / logout and login after you do the changes.
 
\paragraph{Possible problems} If you are not able to compile LifT\_Solver because of some Gurobi errors although you followed the above lines, it may be due to incompatible gcc version. You can try the following:\\
Open terminal, go to \texttt{gurobi902/linux64/src/build} and run \texttt{make} here. You obtain a new file \texttt{libgurobi\_c++.a}. Go to \texttt{gurobi902/linux64/lib} and replace the old file \texttt{libgurobi\_c++.a} with the one that you generated. \textbf{Note:} You should back up the original \texttt{libgurobi\_c++.a} before replacing it!

\section{Program Use}\label{sec:programUse}
 

After successful compilation, you should obtain executable file \texttt{run-disjoint-paths}.\\
You can run the solver by calling, \texttt{./run-disjoint-paths -c params\_sequence.ini}. Instead of \texttt{params\_sequence.ini}, you can use the path to your parameter file. You find an example parameter file in directory \texttt{examples}.

%TODO Specify compulsory parameters
%TODO Set example paths to paths where examples will be stored

\subsection{Parameter File}
%arameters related to graphs sparsificatioin are marked with (S).\\
\textbf{Due parameters}
\begin{itemize}
 \item  $[\text{\texttt{SOLVER}}]$\\
 A keyword that must be placed in the file before the other parameters.
 \item  \texttt{INPUT\_GRAPH = /home/LifT\_Solver/examples/ex1/problemDesc} \\
 Path to the file with input graph.
 

 

 \end{itemize}
 \textbf{Optional parameters}
 \begin{itemize} 
 
 \item  \texttt{INPUT\_FRAMES=/home/LifT\_Solver/examples/ex1/problemDesc\_frames}\\
 Input file with time frame information. If this parameters is not provided, its value is set to the value of INPUT\_GRAPH with suffix "\_frames".
  \item \texttt{OUTPUT\_PATH = /home/LifT\_Solver/examples/ex1/}\\
 Path to a directory where the output files will be stored. If this parameter is not provided, it is set to the path where the input graph is stored. Do not forget the slash at the end of the string.
 
 \item \texttt{OUTPUT\_PREFIX = output} \\
 Multiple output files will be produced. This is their common prefix. If not set, the default value \texttt{output} will be used.
 
 \item  \texttt{DEBUG\_OUTPUT\_FILES = 0} \\
 Expects 0/1 values. If set to 1, the solver outputs preliminary feasible solutions obtained during its run. Default value is 0.
 
 \item  \texttt{SPARSIFY = 1} \\
 Expects value 0/1. If set to 0, no sparsification is done, so parameters related to sparsificatioin are not needed. If set to 1, sparsification is done. Default and recommended value is 1.
 
%  \item  RESTRICT\_FRAMES = 1 \\
%  Expects value 0/1. If set to 1, only time frames up to MAX\_TIMEGAP are used. If set to 0, all time frames are used

 
 \item  \texttt{MAX\_TIMEGAP = 900} \\
 Expects a positive integer. Maximum number of time frames to be used for the input. Only frames 1,2,...,MAX\_TIMEGAP are used for the computation. If you want to use all time frames, either leave this parameter out or set it to zero or to a sufficiently large value. 
 
 \item  \texttt{INPUT\_COST = 0.0}\\
Expects a real value. Cost of starting a track. Default value is 0. 
 
 \item  \texttt{OUTPUT\_COST =0.0} \\
Expects a real value. Cost of terminating a track. Default value is 0. 

 \item  \texttt{SMALL\_INTERVALS = 40}\\
 Expects a non-negative integer stating the amount of time frames used for creating sub-tasks (step one in the two-step procedure). If set to $0$, solver operates on the whole graphs as they are given (after their sparsification). If set to a higher value, graphs are divided into smaller intervals of the given length. Obtained solution on intervals is used for creating tracklets. These tracklets become nodes of newly created graphs. The new graphs are used for further optimization. Default value is 40.

%  \item  AUTOMATIC\_LIFTED = 1 \\  %Default one
%  Expects 0/1 values. If set to 0, lifted edges are assumed to be stored separately in the INPUT\_GRAPH file. Value 0 means that the cost values for lifted edges are obtained from the base edge part of the INPUT\_GRAPH file.
%  they are created as copies of base edges.
%  Default 0.
%   
 \item  \texttt{GUROBI\_REL\_GAP = 0} \\
 Expects a non-negative real value. Setting Gurobi relative gap. Influences solutions where the problem graph nodes correspond one to one to the input graph nodes.
 
 \item  \texttt{GUROBI\_REL\_GAP\_TRACKLET = 0}\\
Expects a non-negative real value. Setting Gurobi relative gap. Influences solution where the problem graph nodes correspond to tracklets.
 \end{itemize}
 
\textbf{Base graph sparsificatioin parameters}
 \begin{itemize}
 \item  \texttt{MAX\_TIMEGAP\_BASE = 50} \\
 Expects a positive integer. Maximal time gap for the base edges (amount of time frames).
 
 
 \item  \texttt{KNN\_K = 3} \\
 Expects a positive integer.  For every vertex and every time gap, up to \texttt{KNN\_K} nearest neighbors can be connected by a base edge with that vertex.  
 
 \item  \texttt{KNN\_GAP = 6}\\
   Expects a non-negative integer. Up to \texttt{KNN\_GAP}, all found nearest neighbors are connected with a processed vertex. Beyond \texttt{KNN\_GAP}, edges to nearest neighbors have to additionally satisfy other constraints in order to be used.
  
 
 \item  \texttt{BASE\_THRESHOLD = 0.0} \\
 Expects a real value. Upper threshold for cost of base edges with a bigger time gap than \texttt{KNN\_GAP}. Edges longer than \texttt{KNN\_GAP} have to have cost lower than this threshold in order to be used. Default value is 0.
 

 
 %TODO add the new parameters. E.g. related to tracklets!
 
%  \item  REQUIRE\_IMPROVING = 0\\
%   Expects 0/1 values. If set to 1, every base edge with gap higher than KNN\_GAP is additionally checked if its cost is lower than costs of all edges from the same vertex with lower time gap. Default value 0.%It can lead to a speed up of the process but it is also possible that the quality of the output will be worse.

 \end{itemize}
 
\textbf{Lifted graph sparsification parameters}
 \begin{itemize}
 
  \item  \texttt{MAX\_TIMEGAP\_LIFTED = 60}\\
 Expects a non-negative integer. Maximal time gap for the lifted edges. 
 
 \item  \texttt{DENSE\_TIMEGAP\_LIFTED =4} \\
  Expects a non-negative integer. Every lifted edge with time gap lower or equal to this value will be added if it satisfies the constraints on its cost value given by \texttt{NEGATIVE\_THRESHOLD\_LIFTED} and \texttt{POSITIVE\_THRESHOLD\_LIFTED}.
  
 \item  \texttt{NEGATIVE\_THRESHOLD\_LIFTED = -0.5}\\
 Expects a non-positive real value. Lifted edges with negative cost will only be added if their cost value is lower or equal to this number. 
 
 \item  \texttt{POSITIVE\_THRESHOLD\_LIFTED = 0.5} \\
  Expects a non-negative real value. Lifted edges with positive cost will only be added if their cost value is higher or equal to this number. 
 
 \item  \texttt{LONGER\_LIFTED\_INTERVAL = 4}\\
Expects a positive integer. Influences lifted edges with time gap between \texttt{DENSE\_TIMEGAP\_LIFTED} and \texttt{MAX\_TIMEGAP\_LIFTED}. If set to value $n$, only every $n$-th time gap will be used for adding lifted edges. 

\item \texttt{TRACKLET\_SIZE=20}\\
Expects a non-negative integer. Maximal length of tracklets used in the second step of our two-step procedure. After finishing the first step, resulting tracks are further cut in time frames given by multiples of \texttt{TRACKLET\_SIZE}. If this parameter is set to 0, no splitting after the first step is done and the whole  tracks resulting from the first step are used as tracklets.  Default value is equal to \texttt{SMALL\_INTERVALS}.

\item \texttt{ALL\_BASE\_TRACKLET=1}\\
Expects 0/1. If set to 1, all base edges from the input graph (before sparsification) can be used for connecting two tracklets. If set to zero, only those tracklets can be connected with a new base edge, if the cumulative cost between them is lower or equal to \texttt{BASE\_THRESHOLD}.
 
\item \texttt{DENSE\_TRACKLETS = 1}\\
Expects 0/1. It has influence only if \texttt{SMALL\_INTERVALS=0}. That is, when problem is solved directly on the whole input graphs without dividing into intervals. If set to zero, no second step is performed. If set to one, resulting tracks are cut into tracklets and the second step of the two-step procedure is run on the obtained tracklet graphs.

\item \texttt{OPTIMIZE\_PATHS = 0}\\
 Expects 0/1. Influences creating tracklets from tracks. In order to understand this parameter, first see the "Note to sparsification" below this parameter list. In the second step, all edges of the input graphs up to certain time gap are used for evaluating cost and enable connections between tracklets. Therefore, it may be beneficial to split some tracks with respect to this more accurate evaluation. If this parameter is one, optimal splitting is searched for every initial track. If set to zero, only simple search for advantageous break points is done.
 
 \item \texttt{COMPLETE\_GAP\_IN\_TRACKLET= 1 }\\
Expects 0/1. Influences how long edges are used for creating tracklet graph and for evaluating cost between tracklets. If set to one, all base and lifted edges up to \texttt{MAX\_TIMEGAP\_COMPLETE} are used. If set to zero, \texttt{MAX\_TIMEGAP\_BASE} and \texttt{MAX\_TIMEGAP\_LIFTED} are used for selecting the base and the lifted edges.
\item \texttt{MAX\_TIMEGAP\_COMPLETE = 60}\\
Expects a positive integer. Influences the second step of the two-step procedure. If \texttt{COMPLETE\_GAP\_IN\_TRACKLET} is set to one, this value is used for selection of base and lifted edges in creating the tracklet graph.  Its default value is the maximum from \texttt{MAX\_TIMEGAP\_BASE} and \texttt{MAX\_TIMEGAP\_LIFTED}.

\item \texttt{INTERVAL\_FILE=/home/LifT\_Solver/examples/ex1/output-all-paths-INTERVALS.txt}\\
Can be used for loading the results of the first step and directly running the second step. For this scenario, parameter \texttt{TASK} must be set to \texttt{T}. Expects path to a file where results of the first step are stored. These files have suffix \texttt{"-all-paths-INTERVALS.txt"}.
\item \texttt{TASK=C}\\
 Expects either character \texttt{C} for performing the complete task. That is both steps of the two-step procedure or \texttt{T} for only performing the second step. In this case, \texttt{INTERVAL\_FILE} must be set to a valid path to a file.

\end{itemize}

\paragraph{Note to sparsification}
The above mentioned sparsification parameters influence only the first step of our two-step procedure. In the second step, aggregated costs between two tracklets are obtained by summing up all relevant lifted edges up to \texttt{MAX\_TIMEGAP\_LIFTED} plus cost of the base edge connecting the last vertex of the first tracklet with the first vertex of the second tracklet. 




\subsection{Graph File}
\begin{itemize}
	\item First line contains one number: number of vertices (without counting $s$ and $t$).
	\item Second line must be empty!
	\item Further lines contain definitions of edges. 
	
\end{itemize}

Note that two special vertices $s$ and $t$ are added automatically. Vertices are numbered from zero. If the given number of vertices is $n$, then vertex $s$ has index $n$ and vertex $t$ has index $n+1$. Edges from $s$ to all vertices are automatically added to $G$. Edges from all vertices to $t$ are automatically added  to $G$ too. The file has to contain just edges between vertices $0,\dots, n-1$. 

\paragraph{Defining edges }Each edge is defined on a separate line. Each line must contain three comma separated values: Index of the first vertex, index of the second vertex, edge cost.

\subsection{File with Time Frames}
This file must provide list of vertices that belong to each time frame. Every vertex must be on a separate line. Every line must contain two comma separated values. The first value is the index of a graph vertex (numbered from zero), the second is the index of its time frame (numbered from one). The vertices must be stated in ascending order. That is, first line contains vertex 0, second line contains vertex 1, etc.

\section{Output Files}
All output files have the same prefix specified in \texttt{OUTPUT\_PREFIX}. 
\paragraph{List of  Output Files}
\begin{itemize}
\item \texttt{-all-paths-FINAL.txt}\\
File with final results. Each line contains one resulting track. Vertices within one track are space separated.
\item \texttt{-all-paths-INTERVALS.txt}\\
Tracks resulting from the first step. That is from the solution on subintervals of the whole graph.
\item \texttt{-params.txt}\\
List of parameter values used for the current solver run.
\item \texttt{-info.txt}\\
Contains log informations about the current state of solving. All the information contained in this file are in addition printed to standard output.
\item \texttt{-gurobi.log, -tr-gurobi.log}\\
Contains all logs output by gurobi. \texttt{-tr-gurobi.log} stores logs from gurobi solving the problem on tracklet graphs.
\item \texttt{-optimization.log, -tr-optimization.log}\\
Contains some additional logs of optimization tasks. 
\item \texttt{-all-paths-FEASIBLE-0.txt, -tr-all-paths-FEASIBLE-0.txt}\\
Tracklets obtained from intermediate feasible solutions. \texttt{-tr} stores tracklets produces from solver run on tracklet graphs. These files are produced only if \texttt{DEBUG\_OUTPUT\_FILES = 1}.
\end{itemize}


\end{document}
